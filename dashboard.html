<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Simple Range Finder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --primary-green: #0d9488;
            --secondary-green: #14b8a6;
            --accent-orange: #f59e0b;
            --light-green: #5eead4;
            --dark-green: #134e4a;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-variant: #334155;
            --on-surface: #f1f5f9;
            --on-surface-variant: #cbd5e1;
            --outline: #475569;
            --off: #ef4444;
            --shadow: rgba(0,0,0,0.25);
            --shadow-strong: rgba(0,0,0,0.5);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        body {
            background: var(--background);
            color: var(--on-surface);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* --- Header --- */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--outline);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 1.5rem;
            margin: 0;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
        }

        .nav-links a {
            color: var(--on-surface-variant);
            text-decoration: none;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
            background-color: var(--secondary-green);
            color: white;
        }

        .nav-links a:hover {
            background: var(--primary-green);
        }

        /* --- Main Content --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        @media (min-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: 0 4px 12px var(--shadow);
            border: 1px solid var(--outline);
        }

        .card h2 {
            margin-bottom: 1.5rem;
            color: var(--on-surface);
            border-bottom: 1px solid var(--outline);
            padding-bottom: 1rem;
            font-size: 1.25rem;
        }

        .btn {
            background: var(--secondary-green);
            color: var(--dark-green);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background: var(--primary-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn-danger { background: #b91c1c; color: white; }
        .btn-danger:hover { background: #991b1b; }
        .btn-secondary { background: var(--surface-variant); color: var(--on-surface); }
        .btn-secondary:hover { background: var(--outline); }
        
        /* --- Course List Styling --- */
        .course-list { list-style: none; }
        .course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            transition: all 0.2s ease;
            background-color: var(--surface-variant);
            border: 1px solid var(--outline);
        }
        .course-item:hover { background: var(--surface); transform: scale(1.02); }
        .course-info h3 { margin: 0; color: var(--on-surface); }
        .course-meta { font-size: 0.875rem; color: var(--on-surface-variant); margin-top: 0.25rem; }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .status-approved { background: #059669; color: white; }
        .status-pending { background: #f59e0b; color: black; }
        .course-actions { display: flex; gap: 0.5rem; }
        .course-actions button { padding: 0.5rem 1rem; font-size: 0.875rem; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal.active { display: flex; }

        .modal-content {
            background: var(--surface);
            color: var(--on-surface);
            padding: 2rem;
            border-radius: var(--radius-lg);
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--outline);
            box-shadow: 0 10px 30px var(--shadow-strong);
        }
        .modal-content h2 { color: var(--secondary-green); margin-bottom: 1.5rem; }

        /* --- Modern Form Styling --- */
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--on-surface-variant); }
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--outline);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            background: var(--surface-variant);
            color: var(--on-surface);
            transition: all 0.2s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary-green);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
        }

        .map-container { height: 400px; border-radius: var(--radius-md); margin-bottom: 1.5rem; }
        .hole-creator { background: var(--surface-variant); padding: 1.5rem; border-radius: var(--radius-md); }
        .hole-list { max-height: 200px; overflow-y: auto; border: 1px solid var(--outline); border-radius: var(--radius-md); padding: 0.5rem; margin-top: 1rem; }
        .hole-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--outline); }
        .hole-item:last-child { border-bottom: none; }
        .hole-marker {
            background: var(--primary-green); border: 3px solid white; border-radius: 50%; color: white;
            width: 32px !important; height: 32px !important; line-height: 28px !important; text-align: center;
            font-weight: bold; box-shadow: 0 3px 6px rgba(0,0,0,0.3); cursor: grab; transition: all 0.2s ease; font-size: 14px;
        }
        .hole-marker:hover { transform: scale(1.2); background: var(--secondary-green); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .center-marker {
    font-size: 24px;
    cursor: grab;
}
        .error { color: #f87171; font-size: 0.875rem; margin-top: 0.5rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--off); border-radius: var(--radius-sm); }
        .loading, .empty-state { text-align: center; color: var(--on-surface-variant); padding: 2rem; font-style: italic; }

        /* --- Mobile Optimizations --- */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; text-align: center; }
            .course-item { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .course-actions { width: 100%; justify-content: flex-end; }
            .modal-content {
                width: 100%;
                height: 100%;
                max-height: 100dvh;
                border-radius: 0;
                padding: 1.5rem;
            }
        }

        @keyframes slideInDown {
    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
}
@keyframes slideOutUp {
    from { transform: translateX(-50%) translateY(0); opacity: 1; }
    to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
}
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>Course Dashboard</h1>
            <nav class="nav-links">
                <a href="index.html">← Back to App</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card" style="background: var(--surface-variant); margin-bottom: 2rem;">
            <h2 style="border: none; padding-bottom: 0;">Welcome, <span id="userEmail"></span>!</h2>
            <p style="color: var(--on-surface-variant);">Manage your created courses or submit a new one for the community.</p>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h2>Your Courses</h2>
                <div id="userCourses"><div class="loading">Loading your courses...</div></div>
                <button class="btn" id="createCourseBtn" style="margin-top: 1.5rem;">Create New Course</button>
            </div>

            <div class="card" id="adminPanel" style="display: none;">
                <h2>Manage All Courses</h2>
                <div id="allCourses"><div class="loading">Loading courses...</div></div>
            </div>
        </div>
    </main>

    <div id="courseModal" class="modal">
        <div class="modal-content">
            <h2 id="courseModalTitle">Create New Course</h2>
            <form id="courseForm">
                <div class="form-group">
                    <label for="courseName">1. Course Name</label>
                    <input type="text" id="courseName" required placeholder="e.g., Augusta National Golf Club">
                </div>

                <div class="form-group">
                    <label>2. Course Location</label>
                    <p style="font-size: 0.875rem; color: var(--on-surface-variant); margin-bottom: 0.75rem;">Pan and zoom to find the course. Drag the 🏌️ marker to set the precise center.</p>
                    <div id="courseMap" class="map-container"></div>
                </div>

                <div class="hole-creator">
                    <h3 style="margin-bottom: 0.5rem; color: var(--on-surface);">3. Add Holes</h3>
                    <p style="font-size: 0.875rem; color: var(--on-surface-variant); margin-bottom: 1rem;">
                        <strong>Click on the map to place the next hole.</strong> You can drag markers to adjust their positions at any time.
                    </p>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="currentHole">Next Hole #</label>
                            <input type="number" id="currentHole" min="1" max="18" value="1">
                        </div>
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="holePar">Par</label>
                            <select id="holePar">
                                <option value="3">3</option>
                                <option value="4" selected>4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label>Holes Added:</label>
                    <div id="holesList" class="hole-list"><div class="empty-state">No holes added yet</div></div>
                </div>

                <div class="error" id="courseError" style="display: none;"></div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; border-top: 1px solid var(--outline); padding-top: 1.5rem;">
                    <button type="submit" class="btn" id="saveCourseBtn">Save Course</button>
                    <button type="button" class="btn btn-secondary" id="cancelCourseBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://ijyosisdbancyaanpdrg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlqeW9zaXNkYmFuY3lhYW5wZHJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5OTI0NTMsImV4cCI6MjA3MjU2ODQ1M30.YjZ3H1OynYfvbeABLut0tSS18mY3CLITTrUeA9wrpIg';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // App state
        let currentUser = null;
        let isAdmin = false;
        let editingCourse = null;
        let courseMap = null;
        let courseHoles = [];
        let courseCenter = [33.7490, -84.3880];

        // DOM elements
        const userEmail = document.getElementById('userEmail');
        const logoutBtn = document.getElementById('logoutBtn');
        const createCourseBtn = document.getElementById('createCourseBtn');
        const courseModal = document.getElementById('courseModal');
        const courseForm = document.getElementById('courseForm');
        const courseModalTitle = document.getElementById('courseModalTitle');
        const saveCourseBtn = document.getElementById('saveCourseBtn');
        const cancelCourseBtn = document.getElementById('cancelCourseBtn');
        const courseError = document.getElementById('courseError');

        async function initializeDashboard() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (!session) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = session.user;
            userEmail.textContent = currentUser.email;

            try {
                const { data: profile } = await supabaseClient.from('profiles').select('role').eq('id', currentUser.id).single();
                isAdmin = profile?.role === 'admin';
                if (isAdmin) {
                    document.getElementById('adminPanel').style.display = 'block';
                    await loadAllCoursesForAdmin();
                }
            } catch (error) {
                console.log('Profile not found or not admin:', error);
            }

            await loadUserCourses();
            setupEventListeners();
        }

        async function loadUserCourses() {
            try {
                const { data, error } = await supabaseClient.from('courses').select(`*, holes (*)`).eq('created_by', currentUser.id).order('created_at', { ascending: false });
                if (error) throw error;
                displayUserCourses(data);
            } catch (error) {
                console.error('Error loading user courses:', error);
                document.getElementById('userCourses').innerHTML = `<div class="error">Error loading your courses</div>`;
            }
        }
        
        async function loadAllCoursesForAdmin() {
            if (!isAdmin) return;
            try {
                const { data, error } = await supabaseClient.rpc('get_all_courses_for_admin');
                if (error) throw error;
                displayAllCoursesForAdmin(data);
            } catch (error) {
                console.error('Error loading all courses for admin:', error);
                document.getElementById('allCourses').innerHTML = `<div class="error">Error loading courses</div>`;
            }
        }

        function displayUserCourses(courses) {
            const container = document.getElementById('userCourses');
            if (!courses || courses.length === 0) {
                container.innerHTML = '<div class="empty-state">You haven\'t created any courses yet.</div>';
                return;
            }
            container.innerHTML = `<ul class="course-list">${courses.map(course => {
                let actions = `<button class="btn btn-secondary" data-action="edit" data-id="${course.id}">Edit</button><button class="btn btn-danger" data-action="delete" data-id="${course.id}">Delete</button>`;
if (isAdmin && course.status === 'pending') {
    actions = `<button class="btn" data-action="approve" data-id="${course.id}">Approve</button>` + actions;
}
                return `<li class="course-item">
                    <div class="course-info">
                        <h3>${course.name}</h3>
                        <div class="course-meta">${course.holes ? course.holes.length : 0} holes • Created ${new Date(course.created_at).toLocaleDateString()}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span class="status-badge status-${course.status}">${course.status}</span>
                        <div class="course-actions">${actions}</div>
                    </div>
                </li>`;
            }).join('')}</ul>`;
        }

        function displayAllCoursesForAdmin(courses) {
            const container = document.getElementById('allCourses');
            const otherUserCourses = courses.filter(course => course.created_by !== currentUser.id);

            if (!otherUserCourses || otherUserCourses.length === 0) {
                container.innerHTML = '<div class="empty-state">No other user courses to manage.</div>';
                return;
            }
            container.innerHTML = `<ul class="course-list">${otherUserCourses.map(course => {
                const actions = course.status === 'pending'
                    ? `<button class="btn" onclick="approveCourse('${course.id}')">Approve</button><button class="btn btn-danger" onclick="rejectCourse('${course.id}')">Reject</button>`
                    : `<button class="btn btn-danger" onclick="deleteCourse('${course.id}')">Delete</button>`;
                return `<li class="course-item">
                    <div class="course-info">
                        <h3>${course.name}</h3>
                        <div class="course-meta">By ${course.creator_email || 'Unknown'} • ${course.holes ? course.holes.length : 0} holes</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span class="status-badge status-${course.status}">${course.status}</span>
                        <div class="course-actions"><button class="btn btn-secondary" onclick="editCourse('${course.id}')">Edit</button>${actions}</div>
                    </div>
                </li>`;
            }).join('')}</ul>`;
        }

        function setupEventListeners() {
            logoutBtn.addEventListener('click', logout);
            createCourseBtn.addEventListener('click', () => openCourseModal());
            cancelCourseBtn.addEventListener('click', closeCourseModal);
            courseForm.addEventListener('submit', saveCourse);
            courseModal.addEventListener('click', (e) => {
                if (e.target === courseModal) closeCourseModal();
            });
            document.getElementById('userCourses').addEventListener('click', handleCourseAction);
            document.getElementById('allCourses').addEventListener('click', handleCourseAction);
        }

        function handleCourseAction(e) {
    const button = e.target.closest('button[data-action]');
    if (!button) return;

    const { action, id } = button.dataset;

    if (action === 'edit') editCourse(id);
    else if (action === 'delete') deleteCourse(id);
    else if (action === 'approve') approveCourse(id);
    else if (action === 'reject') rejectCourse(id);
}

        function openCourseModal(course = null) {
            editingCourse = course;
            courseHoles = [];
            
            if (course) {
                courseModalTitle.textContent = 'Edit Course';
                document.getElementById('courseName').value = course.name;
                courseCenter = [course.center_lat, course.center_lon];
                courseHoles = course.holes ? course.holes.map(h => ({ number: h.hole_number, lat: h.lat, lon: h.lon, par: h.par })) : [];
                document.getElementById('currentHole').value = (course.holes?.length || 0) + 1;
            } else {
                courseModalTitle.textContent = 'Create New Course';
                courseForm.reset();
                courseCenter = [33.7490, -84.3880];
            }
            courseModal.classList.add('active');
            setTimeout(initializeCourseMap, 100);
        }

        function closeCourseModal() {
            courseModal.classList.remove('active');
            if (courseMap) { courseMap.remove(); courseMap = null; }
            showError('');
            editingCourse = null;
            courseHoles = [];
        }

        function initializeCourseMap() {
            if (courseMap) courseMap.remove();

            courseMap = L.map('courseMap').setView(courseCenter, 16);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri',
            maxNativeZoom: 19,
            maxZoom: 22
        }).addTo(courseMap);

            const centerMarker = L.marker(courseCenter, { draggable: true, icon: L.divIcon({ className: 'center-marker', html: '🏌️', iconSize: [20, 20] }) }).addTo(courseMap);
            centerMarker.on('dragend', () => {
                const pos = centerMarker.getLatLng();
                courseCenter = [pos.lat, pos.lng];
            });

            courseHoles.forEach(addHoleMarker);
            
            courseMap.on('click', (e) => {
                addHoleFromMapClick(e.latlng);
            });

            updateHolesList();
        }

        function addHoleFromMapClick(latlng) {
            const holeNumber = parseInt(document.getElementById('currentHole').value);
            const par = parseInt(document.getElementById('holePar').value);

            if (courseHoles.find(h => h.number === holeNumber)) {
                showError(`Hole ${holeNumber} already exists. Change the hole number or drag the existing marker.`);
                return;
            }

            const hole = { number: holeNumber, lat: latlng.lat, lon: latlng.lng, par: par };
            courseHoles.push(hole);
            addHoleMarker(hole);
            updateHolesList();

            document.getElementById('currentHole').value = holeNumber + 1; // Auto-increment
            showError(''); // Clear any previous error
        }

        function addHoleMarker(hole) {
            const marker = L.marker([hole.lat, hole.lon], {
                draggable: true,
                icon: L.divIcon({
                    className: 'hole-marker',
                    html: hole.number,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                })
            }).addTo(courseMap);

            marker.on('dragend', () => {
                const pos = marker.getLatLng();
                const existingHole = courseHoles.find(h => h.number === hole.number);
                if (existingHole) {
                    existingHole.lat = pos.lat;
                    existingHole.lon = pos.lng;
                }
            });
            hole.marker = marker;
        }

        function updateHolesList() {
            const container = document.getElementById('holesList');
            if (courseHoles.length === 0) {
                container.innerHTML = '<div class="empty-state">No holes added yet</div>';
                return;
            }
            const sortedHoles = [...courseHoles].sort((a, b) => a.number - b.number);
            container.innerHTML = sortedHoles.map(hole => `
                <div class="hole-item">
                    <span>Hole ${hole.number} (Par ${hole.par})</span>
                    <button type="button" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="removeHole(${hole.number})">Remove</button>
                </div>
            `).join('');
        }

        function removeHole(holeNumber) {
            const holeIndex = courseHoles.findIndex(h => h.number === holeNumber);
            if (holeIndex > -1) {
                const hole = courseHoles[holeIndex];
                if (hole.marker) courseMap.removeLayer(hole.marker);
                courseHoles.splice(holeIndex, 1);
                updateHolesList();
            }
        }

        async function saveCourse(e) {
            e.preventDefault();
            const courseName = document.getElementById('courseName').value.trim();
            if (!courseName) return showError('Course name is required.');
            if (courseHoles.length === 0) return showError('At least one hole is required.');

            saveCourseBtn.disabled = true;
            saveCourseBtn.textContent = 'Saving...';
            showError('');

            try {
                // Check for existing course name only if it has changed
                if (!editingCourse || (editingCourse && editingCourse.name !== courseName)) {
                    const { data: existing } = await supabaseClient.from('courses').select('id').eq('name', courseName).maybeSingle();
                    if (existing) throw new Error('A course with this name already exists.');
                }
                
                let courseData = { name: courseName, center_lat: courseCenter[0], center_lon: courseCenter[1], zoom: courseMap.getZoom() };
                let courseId;

                if (editingCourse) {
                    const { error } = await supabaseClient.from('courses').update(courseData).eq('id', editingCourse.id);
                    if (error) throw error;
                    courseId = editingCourse.id;
                    await supabaseClient.from('holes').delete().eq('course_id', courseId);
                } else {
                    courseData.created_by = currentUser.id;
                    const { data, error } = await supabaseClient.from('courses').insert(courseData).select().single();
                    if (error) throw error;
                    courseId = data.id;
                }

                const holesData = courseHoles.map(h => ({ course_id: courseId, hole_number: h.number, lat: h.lat, lon: h.lon, par: h.par }));
                const { error: holesError } = await supabaseClient.from('holes').insert(holesData);
                if (holesError) throw holesError;

                closeCourseModal();
                await loadUserCourses();
                if (isAdmin) await loadAllCoursesForAdmin();
            } catch (error) {
                showError(error.message);
            } finally {
                saveCourseBtn.disabled = false;
                saveCourseBtn.textContent = 'Save Course';
            }
        }
        
        function showError(message) {
    if (courseError && courseError.style.display !== 'none') {
        courseError.textContent = message;
        courseError.style.display = message ? 'block' : 'none';
    } else {
        createToast(message, 'error');
    }
}

function showSuccess(message) {
    createToast(message, 'success');
}

function createToast(message, type) {
    const toast = document.createElement('div');
    const bgColor = type === 'error' ? '#d32f2f' : 'var(--secondary-green)';

    toast.style.cssText = `
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        background: ${bgColor}; color: white; padding: 1rem 1.5rem;
        border-radius: var(--radius-md); z-index: 10001; font-weight: 500;
        box-shadow: 0 4px 12px var(--shadow-strong); max-width: calc(100vw - 2rem);
        text-align: center; animation: slideInDown 0.3s ease;
    `;

    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => {
        toast.style.animation = 'slideOutUp 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
    }, type === 'error' ? 5000 : 3000);
}

        async function editCourse(courseId) {
            try {
                const { data, error } = await supabaseClient.from('courses').select(`*, holes (*)`).eq('id', courseId).single();
                if (error) throw error;
                openCourseModal(data);
            } catch (error) {
                showError('Error loading course data: ' + error.message);
            }
        }

        async function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course? This cannot be undone.')) return;
            try {
                const { error } = await supabaseClient.from('courses').delete().eq('id', courseId);
                if (error) throw error;
                await loadUserCourses();
                if (isAdmin) await loadAllCoursesForAdmin();
            } catch (error) {
                showError('Error deleting course: ' + error.message);
            }
        }

        async function approveCourse(courseId) {
            try {
                const { error } = await supabaseClient.from('courses').update({ status: 'approved' }).eq('id', courseId);
                if (error) throw error;
                await loadUserCourses();
                if (isAdmin) await loadAllCoursesForAdmin();
            } catch (error) {
                showError('Error approving course: ' + error.message);
            }
        }

        async function rejectCourse(courseId) {
            await deleteCourse(courseId);
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        }

        initializeDashboard();
    </script>
</body>
</html>